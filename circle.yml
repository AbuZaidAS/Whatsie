general:
  branches:
    only:
      - deploy
  artifacts:
    - dist

machine:
  node:
    version: 0.12.0
  pre:
    - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.6 10
    - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.6 10
    - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.9 20
    - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.9 20
    - sudo apt-get install ruby-dev gcc make rpm
    - rvmsudo gem install fpm

dependencies:
  post:
    - gulp download:linux32 --verbose
    - gulp download:linux64 --verbose
  cache_directories:
    - cache
    - src/node_modules

test:
  post:
    - gulp rebuild:32
    - gulp pack:linux32:deb --prod --verbose
    - gulp pack:linux32:rpm --prod --verbose
    - gulp rebuild:64
    - gulp pack:linux64:deb --prod --verbose
    - gulp pack:linux64:rpm --prod --verbose
    - gulp publish:github
